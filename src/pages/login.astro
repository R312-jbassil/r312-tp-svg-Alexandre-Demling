---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Login">
  <h1>Login</h1>
  <form id="login-form" class="flex flex-col gap-2">
    <input type="email" name="email" placeholder="Email" required />
    <input type="password" name="password" placeholder="Mot de passe" required />
    <button type="submit">Se connecter</button>
  </form>

  <script>
    const form = document.querySelector('#login-form');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      const body = {
        email: formData.get('email'),
        password: formData.get('password'),
      };

      const res = await fetch('/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body),
      });

      if (res.ok) {
        const data = await res.json();
        localStorage.setItem('user', JSON.stringify(data.user));
        window.location.href = '/generator';
      } else {
        alert('Identifiants incorrects');
      }
    });
  </script>
</Layout>
