---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Signup">
  <h1>Créer un compte</h1>
  <form id="signup-form" class="flex flex-col gap-2">
    <input type="email" name="email" placeholder="Email" required />
    <input type="password" name="password" placeholder="Mot de passe" required />
    <input type="password" name="passwordConfirm" placeholder="Confirmer le mot de passe" required />
    <button type="submit">Créer le compte</button>
  </form>

  <script>
    const form = document.querySelector('#signup-form');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      const body = {
        email: formData.get('email'),
        password: formData.get('password'),
        passwordConfirm: formData.get('passwordConfirm'),
      };

      const res = await fetch('/api/signup', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body),
      });

      if (res.ok) {
        const data = await res.json();
        localStorage.setItem('user', JSON.stringify(data.user));
        window.location.href = '/generator';
      } else {
        const err = await res.json();
        alert(err.error || 'Erreur à la création');
      }
    });
  </script>
</Layout>
